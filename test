#!/data/data/com.termux/files/usr/bin/bash

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[1;34m'
NC='\033[0m' # No Color

# Variables
NS=''
LOOP_DELAY=5
declare -a HOSTS=('')
DIG_EXEC="DEFAULT"
CUSTOM_DIG=/data/data/com.termux/files/home/go/bin/fastdig
VER=0.1

# Functions
endscript() {
    unset NS A LOOP_DELAY HOSTS _DIG DIG_EXEC CUSTOM_DIG T R M
    exit 1
}

trap endscript 2 15

check() {
    for ((i=0; i<"${#HOSTS[*]}"; i++)); do
        for R in "${NS}" "${A}" "${NS1}" "${A1}" "${NS2}" "${A2}" "${NS3}" "${A3}"; do
            T="${HOSTS[$i]}"
            $(timeout -k .3 .3 ${_DIG} @${T} ${R}) && M=31 || M=32
            echo -e "\e[1;${M}m\$ R:${R} D:${T}\e[0m"
            unset T R M
        done
    done
}

# Menu functions
add_dns() {
    read -p "Enter DNS to add: " dns
    HOSTS+=("$dns")
    echo -e "${GREEN}DNS added successfully!${NC}"
}

remove_dns() {
    read -p "Enter DNS to remove: " dns
    for i in "${!HOSTS[@]}"; do
        if [[ "${HOSTS[$i]}" == "$dns" ]]; then
            unset 'HOSTS[i]'
            echo -e "${GREEN}DNS removed successfully!${NC}"
        fi
    done
}

remove_all_dns() {
    HOSTS=('')
    echo -e "${GREEN}All DNS removed successfully!${NC}"
}

add_nameserver() {
    read -p "Enter Nameserver to add: " nameserver
    NS="$nameserver"
    echo -e "${GREEN}Nameserver added successfully!${NC}"
}

remove_nameserver() {
    NS=''
    echo -e "${GREEN}Nameserver removed successfully!${NC}"
}

remove_all_nameservers() {
    NS=''
    echo -e "${GREEN}All Nameservers removed successfully!${NC}"
}

loop_delay() {
    read -p "Enter loop delay (0-5 seconds): " delay
    if [[ $delay =~ ^[0-5]$ ]]; then
        LOOP_DELAY=$delay
        echo -e "${GREEN}Loop delay set to ${LOOP_DELAY} seconds!${NC}"
    else
        echo -e "${RED}Invalid input! Please enter a number between 0 and 5.${NC}"
    fi
}

start_digging() {
    echo -e "${BLUE}Starting dig...${NC}"
    while true; do
        check
        echo '.--. .-.. . .- ... .     .-- .- .. -'
        sleep ${LOOP_DELAY}
    done
}

# Main menu
while true; do
    clear
    echo -e "${YELLOW}DNS Digging Script v${VER}${NC}"
    echo -e "${BLUE}1. Add DNS${NC}"
    echo -e "${BLUE}2. Remove DNS${NC}"
    echo -e "${BLUE}3. Remove All DNS${NC}"
    echo -e "${BLUE}4. Add Nameserver${NC}"
    echo -e "${BLUE}5. Remove Nameserver${NC}"
    echo -e "${BLUE}6. Remove All Nameservers${NC}"
    echo -e "${BLUE}7. Set Loop Delay${NC}"
    echo -e "${BLUE}8. Start Digging${NC}"
    echo -e "${BLUE}9. Exit${NC}"
    read -p "Choose an option: " option

    case $option in
        1) add_dns ;;
        2) remove_dns ;;
        3) remove_all_dns ;;
        4) add_nameserver ;;
        5) remove_nameserver ;;
        6) remove_all_nameservers ;;
        7) loop_delay ;;
        8) start_digging ;;
        9) endscript ;;
        *) echo -e "${RED}Invalid option!${NC}" ;;
    esac
    read -p "Press [Enter] key to continue..."
done
